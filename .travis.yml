language: python
python:
  - 3.8
before_install:
  - openssl aes-256-cbc -K $encrypted_fb088dcee1f3_key -iv $encrypted_fb088dcee1f3_iv
    -in secrets.json.enc -out secrets.json -d
install:
  - pip install -r requirements.txt
script:
  - python manage.py test
cache:
  directories:
    - "$HOME/.m2/repository"
    - "$HOME/.gradle"
before_deploy:
  - mkdir -p before-deploy # zip에 포함시킬 파일들을 담을 디렉토리 생성
  - cp Dockerfile before-deploy/ # Dockerfile 복사하기
  - cp appspec.yml before-deploy/ # CodeDeploy 에게 필요한 appspec.yml 파일
  - cd before-deploy && zip -r before-deploy * # before-deploy로 이동후 전체 압축
  - cd ../ && mkdir -p deploy # 상위 디렉토리로 이동후 deploy 디렉토리 생성
  - mv before-deploy/before-deploy.zip deploy/aws-carping.zip # deploy로 zip파일 이동
deploy:
  - provider: s3
    access_key_id:
      secure: j3Jo+9vXSWkccc1VAj8KAX8ZbrF9hbQkRMmmbnr8IkVwnJjpCAKFW3mgiaCI8XlsGnL2ujRwlWD6EsFxcFMspgeOsWKLDnQPDUxuYGMzl//YJ5OjJXhLR72RbpRNULLlD1eMLVLnN/WdUkD17m57XClCI/n0o9uLY+03+m5c2ltWrmkuwJ/80bXoNL7S6dedR+WQOA712HiAMxtDXoWBRXXSjM66dxU2OrxLJXBpe/dU7wXAQ6Ft1mn1a+57FMC0do29d/fxFtiqUBDQP0Mt+bey9++hAOF0MFMEN0hp1qa+u0ureUMbL0p7Be5OvhltVwQZhcW4p902L9GuULQ5R1PhbD3ScpsaKGIrZMKYUKuHlKqEew1tLK5RnQO9RSXkmYAkJ2yZ7nzjq4NjAv+tw5G7vEdLmAbRC9x/mMkrnQGUcFghZUzPCEOyUw/fy7Hqh6azduDyPdu359NokUEMbqbasj6sS2q0+B1QnXhKxhFI8hc4eA/Kese7HpdvkmTs15/1ur2sWCVMX+wAYjUYwSm97CH0upLVp6oJhanxnXln9voMTCEQQpplwSJjsodBdZ3+YH3yZxJeqjTgm0l2ybt3T6Iq0Edwa4MRyhC/fK9Leho+JsZ09/F4l3IEGHQYJaNJ7Q6ZlK/i1T83vdpSkL9HJy7hN6c+5ep/H6rOKcg=
    secret_access_key: &1
      secure: vaytseV8dvuqHgp0x2pDAY1dTFu/MP+GTcJj2BxH3XSCTEoPtDl0fnV6T4xkUpXDVSW2b44mEW4gCqGBBW42CpSRLs4ZB7wVmroLvd2TQOX6WQRx6TpyW9LFP4Zf3lf9JKFjE3U9nvXpUrNFwEEOm9E/f/uAaiqm8NxLzRFMzIJGzdvO+Mhd1/tMfeDiGFygYyc7INkmDZ8T1ke84W8kY/iKyqKXpOIMZ5BSvpTdA1tS7laeOEFkjwPcgLOFiYA+OFZHgmNf+JkjoHECTYZLBmp9agClyqikmBsJ9Zp5BD4E6Z8Md3L4sn5KuqvSEH6+fO3qJ1YK8rZQVRbJhEEnHB2BldflQ2LqdtvdNDXTxBFPwbjZR7Y19KBX/vmtv1oVshTb+tVH8zeZRJ+aOL/1Sysm3QCPNmRKYXGq0zc/GnbGoyJLNrI2lI8j1qI8lfrg1vma0FBla2LreqSNh01/X0eBqNPvFy+Vr02PSzTQHwkWbebrpmmzJ5chImLOTts1RafL8S3QODSSfOE+D83b7r0c27Xb2Fh9ZZz9RHca3I0x8hGpRFpQX4wQSJ/HlJblThgGOaDJEwAUAVJeh3q9Pxld8qB/xlUoYyiSqAPbHbnHpxSQyuVV+eb8AO1JaJOMWkVm2KlYkG+Qdr1B7kBD3QA0cM84yEymeEcWogi91GI=
    local_dir: deploy
    skip_cleanup: true
    on: &2
      repo: TourKakao-Carping/Carping-Backend
      branch: main
    region: ap-northeast-2
    bucket: chanjongs
